---
layout: post
title: Zen and the Art of Malware Detection
date: 2013-01-15 17:47:00.000000000 -08:00
type: post
published: true
status: publish
categories: []
tags: []
meta:
  _publicize_pending: '1'
author:
  login: phoneboy
  email: dwelch@phoneboy.com
  display_name: Dameon Welch-Abernathy
  first_name: ''
  last_name: ''
---
<p>Detecting malicious code that enters your network is challenging problem that traditional anti-virus and anti-malware can't keep up with. These tools use a series of heuristics and static signatures to try and detect malicious code.</p>
<p><a target="_blank" href="https://twitter.com/djteller">Tomer Teller</a>, a security researcher and evangelist at Check Point, told me about an incident at the <a target="_blank" href="https://events.ccc.de/congress/2012/wiki/Main_Page">29th annual Chaos Communication Congress</a> where the crowd of security professionals were asked if anyone is actually using AV. Not a single person raised their hand.</p>
<p>How much value does AV provide? There was an article put out by Imperva that got misquoted and misrepresented in the media. The main message? AV only catches about 5% of malware. <a target="_blank" href="http://blog.eset.com/2013/01/03/imperva-virustotal-and-whether-av-is-useful">The real story is a bit better</a>, but it's still not all that rosy.</p>
<p>To help you understand why this problem is particularly tricky, consider how many ways you can write a "Hello, World!" program--often one of the first programs you write when learning a computer language. It is so called because the program writes the phrase "Hello, World!" to the output device. It's often a simplistic program, such as the following C-based example:</p>
<blockquote><table>
<tbody>
<tr>
<td>#include &lt;stdio.h&gt;int main() {    printf("Hello Worldn"); }</td>
</tr>
</tbody>
</table>
</blockquote>
<p>A more complex example (<a target="_blank" href="http://www.brandonparker.net/code_obf.php" title="Link: http://www.brandonparker.net/code_obf.php">that I borrowed from here</a>) might look something like this:</p>
<blockquote><table>
<tbody>
<tr>
<td>#include &lt;stdio.h&gt; #define THIS printf(<br />#define IS "%sn"<br />#define OBFUSCATION ,v);<br />double h[2]; int main(_, v) char *v; int _; { int a = 0; char f[32]; h[2%2] = 21914441197069634153456391018824026170709523170177760997320759459436800394073 07212501870429040900672146338833938303659439237740635160500855813030357492372 682887858054616489605441589829740433065995076650229152079883597110973562880.0 00000; h[4%3] = 1867980801.569119; switch (_) { case 0: THIS IS OBFUSCATION break; default: main(0,(char *)h); break; } }</td>
</tr>
</tbody>
</table>
</blockquote>
<p>Replace "print Hello World" with "inject code into target host using latest exploit" and you can begin to understand why it is so hard to detect malicious code by simple inspection.</p>
<p>That isn't to say that static analysis provides no value--it does. It catches the really obvious stuff. Unfortunately, it's not foolproof.</p>
